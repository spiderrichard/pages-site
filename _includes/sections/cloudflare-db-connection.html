<style>
    .cloudflare-db-connection h1 {
        margin: var(--contentGap) 0;
    }
</style>
<section class="cloudflare-db-connection">
    <div class="width-control">
        <div class="content-container">
            <h2>Cloudflare Database Connection</h2>
            <p>Use the form below to enter a test message to my cloudflare database and watch the table below update with the results!</p>

            <form id="entryForm">
                <input id="value" placeholder="Type something..." required />
                <button type="submit">Submit</button>
            </form>

            <p id="msg"></p>

            <table id="entriesTable" style="margin-top: 1rem; width: 100%; border-collapse: collapse;">
              <thead>
                <tr>
                  <th style="text-align:left; border-bottom:1px solid #ccc;">Message</th>
                  <th style="text-align:left; border-bottom:1px solid #ccc;">Created</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
        </div>
    </div>
</section>
<script>
    (function () {
      const form = document.getElementById("entryForm");
      const input = document.getElementById("value");
      const msg = document.getElementById("msg");
  
      if (!form || !input) return;
  
      const API_BASE = "https://example-database.spiderrichard.workers.dev";
  
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
  
        const value = input.value.trim();
        if (!value) return;
  
        msg && (msg.textContent = "Saving...");
  
        try {
          const res = await fetch(`${API_BASE}/api/entry`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ value }),
          });
  
          if (!res.ok) throw new Error(await res.text());
  
          input.value = "";
          msg && (msg.textContent = "Saved ✅");
        } catch (err) {
          console.error(err);
          msg && (msg.textContent = "Error saving ❌");
        }
      });
    })();
  </script>